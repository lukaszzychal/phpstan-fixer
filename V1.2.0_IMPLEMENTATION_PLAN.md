# Plan Implementacji v1.2.0

## Priorytetyzacja zadań

### Faza 1: Podstawowe ulepszenia (High Priority)
1. **Dry-run diff output** - Pokazywanie unified diff w suggest mode
   - Użycie `diff` lub `unified_diff` do wyświetlania zmian
   - Format podobny do `git diff`
   - Integracja z istniejącym outputem w Command

2. **Fixer priorities** - Kontrola kolejności wykonania fixerów
   - Dodanie `priority` do `FixStrategyInterface`
   - Sortowanie fixerów w `AutoFixService` według priorytetu
   - Konfiguracja priorytetów w config file

3. **Code review i refaktoryzacja (częściowa)** - Refaktoryzacja diff output
   - ✅ Refaktoryzacja `groupOperationsIntoHunks()` w `PhpstanAutoFixCommand`
   - ✅ Wyciąganie metod pomocniczych dla diff operations
   - ✅ Zastosowanie `match` expression i zasad DRY

### Faza 2: Konfiguracja (Medium Priority)
3. **Configuration file - Enable/disable fixers**
   - Rozszerzenie config o sekcję `fixers`
   - Możliwość włączania/wyłączania poszczególnych fixerów
   - Integracja z `PhpstanAutoFixCommand`

4. **Whitelist/Blacklist** - Konfiguracja plików/katalogów
   - Dodanie `include_paths` i `exclude_paths` do config
   - Filtrowanie plików przed przetwarzaniem
   - Wzorce glob/regex

### Faza 3: Zaawansowane funkcje (Lower Priority)
5. **Custom fixers** - Rejestracja własnych fixerów
   - Interfejs do rejestracji custom fixerów
   - Ładowanie z config file lub przez API
   - Dokumentacja i przykłady

6. **Better type inference** - Lepsze wnioskowanie typów
   - Analiza kontekstu użycia
   - Wykorzystanie type hints z kodu
   - Integracja z PHPStan type system

7. **Framework detection** - Auto-wykrywanie frameworków ✅
   - Wykrywanie Laravel (composer.json, struktura katalogów)
   - Wykrywanie Symfony
   - Automatyczne włączanie framework-specific fixerów

8. **Progress indicators** - Wskaźniki postępu
   - Progress bar dla długich operacji
   - Integracja z Symfony Console ProgressBar
   - Szacowanie czasu wykonania

## Kolejność implementacji

**Sprint 1:**
- [x] Dry-run diff output
- [x] Fixer priorities
- [x] Code review i refaktoryzacja (częściowa - diff output)

**Sprint 2:**
- [x] Configuration file - Enable/disable fixers
- [x] Whitelist/Blacklist

**Sprint 3:**
- [x] Custom fixers
- [x] Better type inference (podstawowa wersja)

**Sprint 4:**
- [ ] Framework detection
- [ ] Progress indicators

**Sprint 5: Code Review i Refaktoryzacja (pełna)**
- [ ] Przegląd całego kodu projektu pod kątem jakości, czytelności i utrzymywalności
- [ ] Refaktoryzacja wszystkich klas i metod
- [ ] Refaktoryzacja metod z zagnieżdżonymi if-else i powtarzającymi się warunkami
- [ ] Wyciąganie logiki do małych, jednoznacznych metod pomocniczych
- [ ] Eliminacja duplikacji kodu w całym projekcie
- [ ] Ujednolicenie wzorców i konwencji
- [ ] Optymalizacja wydajności gdzie potrzebne

## Szczegóły techniczne

### Dry-run diff output
- Użycie `SebastianBergmann\Diff\Differ` lub natywnego `diff`
- Format: unified diff (---/+++)
- Koloryzacja w terminalu
- Opcja `--diff` w Command

### Fixer priorities
```php
interface FixStrategyInterface {
    public function getPriority(): int; // default: 0, wyższe = wcześniej
}
```

### Code review i refaktoryzacja (częściowa - diff output) ✅
- ✅ Refaktoryzacja `groupOperationsIntoHunks()` → podzielone na 10+ małych metod
- ✅ Wyciąganie metod pomocniczych dla diff operations
- ✅ Zastosowanie `match` expression i zasad DRY

### Code review i refaktoryzacja (pełna - Sprint 5)
**Zakres:**
- Przegląd wszystkich klas w `src/PhpstanFixer/`:
  - `Command/PhpstanAutoFixCommand.php` - pełna refaktoryzacja
  - `AutoFixService.php` - optymalizacja i uproszczenie
  - Wszystkie `Strategy/*.php` - ujednolicenie wzorców
  - `CodeAnalysis/DocblockManipulator.php` - uproszczenie logiki
  - `Configuration/*.php` - sprawdzenie spójności
  - `Parser/PhpstanLogParser.php` - optymalizacja parsowania

**Zadania:**
- Przegląd całego kodu projektu pod kątem jakości, czytelności i utrzymywalności
- Refaktoryzacja wszystkich klas i metod
- Identyfikacja i refaktoryzacja metod z zagnieżdżonymi if-else i powtarzającymi się warunkami
- Wyciąganie logiki do małych, jednoznacznych metod pomocniczych
- Wyciąganie wspólnej logiki do traitów lub klas pomocniczych
- Eliminacja duplikacji kodu w całym projekcie (szczególnie między fixerami)
- Ujednolicenie wzorców i konwencji (obsługa błędów, nazewnictwo, struktura)
- Zastosowanie `match` expression zamiast długich if-else gdzie to możliwe
- Optymalizacja wydajności gdzie potrzebne (cache, lazy loading)
- Zastosowanie zasad:
  - Single Responsibility Principle
  - DRY (Don't Repeat Yourself)
  - Clean Code principles
  - SOLID principles
- Dodanie brakujących testów dla refaktoryzowanych fragmentów

### Configuration file structure
```yaml
fixers:
  enabled:
    - MissingReturnDocblockFixer
    - MissingParamDocblockFixer
  disabled:
    - UndefinedPivotPropertyFixer
  priorities:
    MissingReturnDocblockFixer: 100
    MissingParamDocblockFixer: 90

include_paths:
  - src/
  - app/

exclude_paths:
  - vendor/
  - tests/
  - "**/*Test.php"
```

