#!/usr/bin/env php
<?php

/**
 * Copyright (c) 2025 Łukasz Zychal
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 */

declare(strict_types=1);

/**
 * PHPStan Auto-Fix CLI Tool
 *
 * Framework-agnostic tool for automatically fixing PHPStan errors.
 *
 * @author Łukasz Zychal <lukasz.zychal.dev@gmail.com>
 */

// Find the autoloader by traversing up the directory tree
// This works both when package is standalone and when installed as dependency
$autoloader = null;
$dir = __DIR__;
$maxDepth = 10; // Prevent infinite loops

for ($i = 0; $i < $maxDepth; $i++) {
    $possiblePath = $dir . '/vendor/autoload.php';
    if (file_exists($possiblePath)) {
        $autoloader = $possiblePath;
        break;
    }
    
    $parentDir = dirname($dir);
    if ($parentDir === $dir) {
        // Reached filesystem root
        break;
    }
    $dir = $parentDir;
}

if ($autoloader === null) {
    fwrite(STDERR, "Error: Could not find autoload.php.\n");
    fwrite(STDERR, "Please run 'composer install' to install dependencies.\n");
    exit(1);
}

require_once $autoloader;

use PhpstanFixer\Command\PhpstanAutoFixCommand;
use Symfony\Component\Console\Application;

$application = new Application('PHPStan Auto-Fix', '1.0.0');
$application->add(new PhpstanAutoFixCommand());
$application->setDefaultCommand('phpstan:auto-fix', true);
$application->run();

